<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ì˜íœ´ê°€ë¶€ì—¬ - AAA ê´€ë¦¬ì í™ˆ</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/vacation-admin.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>AAA ê´€ë¦¬ì í™ˆ</h1>
            <div class="sidebar-tabs">
                <a href="../index.html" class="sidebar-tab">í™ˆ</a>
                <a href="dashboard.html" class="sidebar-tab">ëŒ€ì‹œë³´ë“œ</a>
                <div class="sidebar-tab-dropdown">
                    <div class="sidebar-tab sidebar-tab-with-dropdown">
                        ì‚¬ìš©ì ê´€ë¦¬
                        <span class="dropdown-arrow">â–¼</span>
                    </div>
                    <div class="sidebar-dropdown-content">
                        <a href="users.html" class="sidebar-dropdown-item">ì¬ì§ì</a>
                        <a href="resigned-users.html" class="sidebar-dropdown-item">í‡´ì‚¬ì</a>
                    </div>
                </div>
                <a href="gifts.html" class="sidebar-tab">ì„ ë¬¼ë³´ë‚´ê¸°</a>
                <div class="sidebar-tab-dropdown">
                    <div class="sidebar-tab sidebar-tab-with-dropdown active">
                        íœ´ê°€ ì´ê´„ ê´€ë¦¬
                        <span class="dropdown-arrow">â–¼</span>
                    </div>
                    <div class="sidebar-dropdown-content">
                        <a href="vacation-requests.html" class="sidebar-dropdown-item">ë¶€ì—¬ìš”ì²­ëª©ë¡</a>
                        <a href="vacation-history.html" class="sidebar-dropdown-item">ë¶€ì—¬ë‚´ì—­</a>
                        <a href="vacation-status.html" class="sidebar-dropdown-item">ì „ì‚¬ì› íœ´ê°€í˜„í™©</a>
                        <a href="vacation-proxy.html" class="sidebar-dropdown-item" style="display: none;">íœ´ê°€ ëŒ€ë¦¬ê²°ì œ</a>
                        <a href="vacation-manual.html" class="sidebar-dropdown-item active">ì„ì˜íœ´ê°€ë¶€ì—¬</a>
                        <a href="vacation-approvers.html" class="sidebar-dropdown-item">ê¶Œí•œê´€ë¦¬ì ì§€ì •</a>
                        <a href="vacation-promotion.html" class="sidebar-dropdown-item" style="display: none;">ì—°ì°¨ì´‰ì§„ê´€ë¦¬</a>
                        <a href="vacation-approval-history.html" class="sidebar-dropdown-item">íœ´ê°€ì‹ ì²­ìŠ¹ì¸ ê´€ë¦¬</a>
                    </div>
                </div>
            </div>
            <div class="user-info">
                <span id="username-display"></span>
                <button id="logout-btn" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="main-content">
            <div class="page-header">
                <div class="header-content">
                    <div class="title-section">
                        <h1>ì„ì˜íœ´ê°€ë¶€ì—¬</h1>
                        <p class="subtitle">ê´€ë¦¬ìê°€ ì§ì›ì—ê²Œ ì§ì ‘ íœ´ê°€ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>

            <!-- ë¶€ì—¬ í¼ -->
            <div class="filter-section">
                <div class="filter-card" style="padding: 32px; display: block;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 32px; padding-bottom: 20px; border-bottom: 2px solid #f1f3f4;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: 700;">ğŸ“</div>
                        <h3 style="margin: 0; font-size: 20px; font-weight: 700; color: #191f28;">íœ´ê°€ ë¶€ì—¬ ì •ë³´ ì…ë ¥</h3>
                    </div>

                    <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #6c757d; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">ê¸°ë³¸ ì •ë³´</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <!-- ì—°ë„ ì„ íƒ -->
                            <div class="form-group">
                                <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">
                                    ì—°ë„ <span style="color: #ef4444;">*</span>
                                </label>
                                <select id="year-select" class="filter-select" required style="width: 100%;">
                                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                                </select>
                            </div>

                            <!-- íœ´ê°€ ìœ í˜• -->
                            <div class="form-group">
                                <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">
                                    íœ´ê°€ ìœ í˜• <span style="color: #ef4444;">*</span>
                                </label>
                                <select id="leave-type-select" class="filter-select" required style="width: 100%;">
                                    <option value="">ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì—°ì°¨">ì—°ì°¨</option>
                                    <option value="ì˜ˆë¹„êµ°/ë¯¼ë°©ìœ„ ì—°ì°¨">ì˜ˆë¹„êµ°/ë¯¼ë°©ìœ„ ì—°ì°¨</option>
                                    <option value="ë³‘ê°€">ë³‘ê°€</option>
                                    <option value="ê²½ì¡°ì‚¬">ê²½ì¡°ì‚¬</option>
                                    <option value="ë³´ìƒíœ´ê°€">ë³´ìƒíœ´ê°€</option>
                                    <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
                                </select>
                                <!-- ì§ì ‘ì…ë ¥ ì‹œ í‘œì‹œë˜ëŠ” ì…ë ¥ í•„ë“œ -->
                                <input type="text" id="custom-leave-type" class="filter-select"
                                       placeholder="ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; margin-top: 8px; display: none;">
                            </div>
                        </div>
                    </div>

                    <!-- ëŒ€ìƒ ì§ì› ì„ íƒ ì„¹ì…˜ -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #6c757d; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">ëŒ€ìƒ ì§ì›</h4>
                        <div class="form-group">
                            <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">
                                ì§ì› ì„ íƒ <span style="color: #ef4444;">*</span>
                            </label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 12px;">
                                <div>
                                    <select id="department-select" class="filter-select" style="width: 100%;">
                                        <option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                    </select>
                                </div>
                                <div>
                                    <select id="user-select" class="filter-select" required style="width: 100%;">
                                        <option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                                    </select>
                                </div>
                            </div>
                            <div id="selected-user-info" style="padding: 14px 16px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 1.5px solid #0ea5e9; border-radius: 10px; display: none; margin-top: 12px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">âœ“</div>
                                    <div>
                                        <div style="font-size: 12px; color: #0369a1; font-weight: 600; margin-bottom: 2px;">ì„ íƒëœ ì§ì›</div>
                                        <div style="font-size: 15px; color: #0c4a6e; font-weight: 700;" id="selected-user-name">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- íœ´ê°€ ì •ë³´ ì„¹ì…˜ -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #6c757d; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">íœ´ê°€ ì •ë³´</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <!-- ë¶€ì—¬ ì¼ìˆ˜ -->
                            <div class="form-group">
                                <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">
                                    ë¶€ì—¬ ì¼ìˆ˜ <span style="color: #ef4444;">*</span>
                                </label>
                                <input type="number" id="grant-days" class="filter-select" 
                                       placeholder="ì˜ˆ: 3.5 ë˜ëŠ” -1" step="0.5" required style="width: 100%;">
                                <small style="color: #6b7280; font-size: 12px; margin-top: 6px; display: block; line-height: 1.4;">
                                    ğŸ’¡ ì†Œìˆ˜ì  ì…ë ¥ ê°€ëŠ¥ (0.5 = ë°˜ì°¨), ë§ˆì´ë„ˆìŠ¤ ê°’ìœ¼ë¡œ íœ´ê°€ ì°¨ê° ê°€ëŠ¥
                                </small>
                            </div>

                            <!-- íœ´ê°€ ë¦¬ì…‹ ë‚ ì§œ -->
                            <div class="form-group">
                                <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">
                                    íœ´ê°€ ë¦¬ì…‹ ë‚ ì§œ
                                </label>
                                <input type="datetime-local" id="leave-reset-date" class="filter-select" style="width: 100%;">
                                <small style="color: #6b7280; font-size: 12px; margin-top: 6px; display: block; line-height: 1.4;">
                                    ğŸ“… í•´ë‹¹ ë‚ ì§œë¶€í„° íœ´ê°€ê°€ ì ìš©ë©ë‹ˆë‹¤ (ì„ íƒì‚¬í•­)
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- ë©”ëª¨ ì„¹ì…˜ -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #6c757d; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">ë¶€ì—¬ ì‚¬ìœ </h4>
                        <div class="form-group">
                            <label style="display: block; font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">
                                ë©”ëª¨ <span style="color: #ef4444;">*</span>
                            </label>
                            <textarea id="memo" class="filter-select" rows="5" 
                                      placeholder="ì˜ˆ: ì•¼ê·¼ ë³´ìƒ, íŠ¹ë³„ í¬ìƒ, íšŒì‚¬ í–‰ì‚¬ ì°¸ì—¬ ë“±&#10;&#10;ì´ ë©”ëª¨ëŠ” ê¸°ë¡ìœ¼ë¡œ ë‚¨ìœ¼ë©°, ì¶”í›„ ê°ì‚¬ ì‹œ ì°¸ê³ ìë£Œê°€ ë©ë‹ˆë‹¤." 
                                      required style="resize: vertical; width: 100%; font-family: inherit; line-height: 1.6;"></textarea>
                            <small style="color: #6b7280; font-size: 12px; margin-top: 6px; display: block; line-height: 1.4;">
                                âš ï¸ ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”
                            </small>
                        </div>
                    </div>

                    <!-- ë²„íŠ¼ ì˜ì—­ -->
                    <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 24px; border-top: 2px solid #f1f3f4;">
                        <button id="reset-btn" style="padding: 12px 28px; background-color: #f8f9fa; color: #495057; border: 1.5px solid #dee2e6; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 14px;" 
                                onmouseover="this.style.backgroundColor='#e9ecef'; this.style.borderColor='#adb5bd';" 
                                onmouseout="this.style.backgroundColor='#f8f9fa'; this.style.borderColor='#dee2e6';">
                            ğŸ”„ ì´ˆê¸°í™”
                        </button>
                        <button id="grant-btn" style="padding: 12px 28px; background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 14px; box-shadow: 0 2px 8px rgba(0, 102, 255, 0.2);" 
                                onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(0, 102, 255, 0.3)';" 
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0, 102, 255, 0.2)';">
                            âœ… íœ´ê°€ ë¶€ì—¬í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/main.js"></script>
    <script src="../js/utils/auth.js"></script>
    <script>
        let departments = [];
        let currentMembers = [];

        document.addEventListener('DOMContentLoaded', function() {
            controlSidebarMenus();

            // admin ê³„ì • í™•ì¸
            const adminId = localStorage.getItem('userId');
            if (!adminId) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '../index.html';
                return;
            }

            initializeYearSelect();
            loadDepartments();
            setupEventListeners();
        });

        // ì—°ë„ ì„ íƒ ì´ˆê¸°í™”
        function initializeYearSelect() {
            const yearSelect = document.getElementById('year-select');
            const currentYear = new Date().getFullYear();
            
            // í˜„ì¬ ì—°ë„ë¶€í„° 5ë…„ í›„ê¹Œì§€
            for (let year = currentYear; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}ë…„`;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        // ë¶€ì„œ ëª©ë¡ ë¡œë“œ
        async function loadDepartments() {
            try {
                console.log('ë¶€ì„œ ëª©ë¡ ì¡°íšŒ ì‹œì‘...');
                
                const response = await fetch('/api/getDepartmentList');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('ë¶€ì„œ ëª©ë¡ ì‘ë‹µ:', data);

                departments = data.departments || [];

                const select = document.getElementById('department-select');
                select.innerHTML = '<option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

                departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    select.appendChild(option);
                });

                console.log('ë¶€ì„œ ëª©ë¡ ë¡œë“œ ì™„ë£Œ:', departments.length);
            } catch (error) {
                console.error('ë¶€ì„œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ë¶€ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ë¶€ì„œ ì„ íƒ ì‹œ ë¶€ì„œì› ë¡œë“œ
            document.getElementById('department-select').addEventListener('change', onDepartmentChange);

            // ì‚¬ìš©ì ì„ íƒ ì‹œ ì •ë³´ í‘œì‹œ
            document.getElementById('user-select').addEventListener('change', onUserSelect);

            // íœ´ê°€ ìœ í˜• ì„ íƒ ì‹œ ì§ì ‘ì…ë ¥ í•„ë“œ í† ê¸€
            document.getElementById('leave-type-select').addEventListener('change', onLeaveTypeChange);

            // íœ´ê°€ ë¶€ì—¬ ë²„íŠ¼
            document.getElementById('grant-btn').addEventListener('click', grantVacation);

            // ì´ˆê¸°í™” ë²„íŠ¼
            document.getElementById('reset-btn').addEventListener('click', resetForm);
        }

        // ë¶€ì„œ ì„ íƒ ì‹œ ë¶€ì„œì› ë¡œë“œ
        async function onDepartmentChange(e) {
            const department = e.target.value;
            const userSelect = document.getElementById('user-select');
            const selectedUserInfo = document.getElementById('selected-user-info');

            if (!department) {
                userSelect.innerHTML = '<option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                selectedUserInfo.style.display = 'none';
                return;
            }

            try {
                console.log('ë¶€ì„œì› ì¡°íšŒ ì‹œì‘:', department);
                
                userSelect.innerHTML = '<option value="">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>';

                const response = await fetch(`/api/getDepartmentMembers?department=${encodeURIComponent(department)}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('ë¶€ì„œì› ì‘ë‹µ:', data);

                currentMembers = data[department] || [];
                
                userSelect.innerHTML = '<option value="">ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                
                currentMembers.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.user_id;
                    option.textContent = `${member.name} (${member.job_position})`;
                    option.setAttribute('data-name', member.name);
                    option.setAttribute('data-position', member.job_position);
                    userSelect.appendChild(option);
                });

                console.log('ë¶€ì„œì› ë¡œë“œ ì™„ë£Œ:', currentMembers.length);
            } catch (error) {
                console.error('ë¶€ì„œì› ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ë¶€ì„œì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                userSelect.innerHTML = '<option value="">ë¶€ì„œì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</option>';
            }
        }

        // ì‚¬ìš©ì ì„ íƒ ì‹œ ì •ë³´ í‘œì‹œ
        function onUserSelect(e) {
            const userId = e.target.value;
            const selectedUserInfo = document.getElementById('selected-user-info');
            const selectedUserName = document.getElementById('selected-user-name');

            if (!userId) {
                selectedUserInfo.style.display = 'none';
                return;
            }

            const selectedOption = e.target.options[e.target.selectedIndex];
            const userName = selectedOption.getAttribute('data-name');
            const userPosition = selectedOption.getAttribute('data-position');

            selectedUserName.textContent = `${userName} (${userPosition})`;
            selectedUserInfo.style.display = 'block';
        }

        // íœ´ê°€ ìœ í˜• ì„ íƒ ì‹œ ì§ì ‘ì…ë ¥ í•„ë“œ í† ê¸€
        function onLeaveTypeChange(e) {
            const leaveType = e.target.value;
            const customInput = document.getElementById('custom-leave-type');

            if (leaveType === 'ì§ì ‘ì…ë ¥') {
                customInput.style.display = 'block';
                customInput.required = true;
                customInput.focus();
            } else {
                customInput.style.display = 'none';
                customInput.required = false;
                customInput.value = '';
            }
        }

        // íœ´ê°€ ë¶€ì—¬
        async function grantVacation() {
            const adminId = localStorage.getItem('userId');
            const year = parseInt(document.getElementById('year-select').value);
            let leaveType = document.getElementById('leave-type-select').value;
            const customLeaveType = document.getElementById('custom-leave-type').value.trim();
            const userId = document.getElementById('user-select').value;
            const grantDays = parseFloat(document.getElementById('grant-days').value);
            const leaveResetDate = document.getElementById('leave-reset-date').value;
            const memo = document.getElementById('memo').value.trim();

            // ì§ì ‘ì…ë ¥ ì„ íƒ ì‹œ ì…ë ¥ í•„ë“œ ê°’ ì‚¬ìš©
            if (leaveType === 'ì§ì ‘ì…ë ¥') {
                if (!customLeaveType) {
                    alert('ì§ì ‘ ì…ë ¥í•  íœ´ê°€ ìœ í˜•ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    document.getElementById('custom-leave-type').focus();
                    return;
                }
                leaveType = customLeaveType;
            }

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!year || !leaveType || !userId || !grantDays || !memo) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (grantDays === 0 || isNaN(grantDays)) {
                alert('ë¶€ì—¬ ì¼ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (0ì€ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)');
                return;
            }

            if (memo.length < 5) {
                alert('ë¶€ì—¬ ì‚¬ìœ ë¥¼ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const userSelect = document.getElementById('user-select');
            const selectedOption = userSelect.options[userSelect.selectedIndex];
            const userName = selectedOption.getAttribute('data-name');

            if (!confirm(`${userName}ë‹˜ì—ê²Œ ${leaveType} ${grantDays}ì¼ì„ ë¶€ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në¶€ì—¬ ì‚¬ìœ : ${memo}`)) {
                return;
            }

            // datetime-local ê°’ì„ RFC3339 í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            let formattedLeaveResetDate = null;
            if (leaveResetDate) {
                // "2026-01-16T15:03" -> "2026-01-16T15:03:00+09:00"
                formattedLeaveResetDate = leaveResetDate + ':00+09:00';
            }

            try {
                const requestBody = {
                    admin_id: adminId,
                    year: year,
                    leave_type: leaveType,
                    user_id: userId,
                    grant_days: grantDays,
                    leave_reset_date: formattedLeaveResetDate,
                    memo: memo
                };

                console.log('íœ´ê°€ ë¶€ì—¬ ìš”ì²­:', requestBody);

                const response = await fetch('/admin/leave/customGrant', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('íœ´ê°€ ë¶€ì—¬ ì‘ë‹µ:', data);

                if (data.error) {
                    throw new Error(data.error);
                }

                alert(`${userName}ë‹˜ì—ê²Œ íœ´ê°€ê°€ ì„±ê³µì ìœ¼ë¡œ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                resetForm();

            } catch (error) {
                console.error('íœ´ê°€ ë¶€ì—¬ ì‹¤íŒ¨:', error);
                alert('íœ´ê°€ ë¶€ì—¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            if (!confirm('ì…ë ¥í•œ ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            document.getElementById('year-select').value = new Date().getFullYear();
            document.getElementById('leave-type-select').value = '';
            document.getElementById('custom-leave-type').value = '';
            document.getElementById('custom-leave-type').style.display = 'none';
            document.getElementById('custom-leave-type').required = false;
            document.getElementById('department-select').value = '';
            document.getElementById('user-select').innerHTML = '<option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('grant-days').value = '';
            document.getElementById('leave-reset-date').value = '';
            document.getElementById('memo').value = '';
            document.getElementById('selected-user-info').style.display = 'none';
        }
    </script>
</body>
</html>
